<div x-data="searchRecipes">
  <div>
    <input
        type="text"
        x-on:input.debounce="getRecipes"
        x-on:keydown.escape="closeSearch"
        placeholder="Rechercher une recette..."
        x-model="searchRecipesInput"
        class="form-control form-control-lg"
        id="qsearch-recipes"
      />
    
    <template x-for="recipe in getRecipes" key:="recipe.url">
     <a :href="recipe.url">
       <div class="searchCard">
         <div>
           <div>
             <span class="fs-5" :href="recipe.url" x-text="recipe.title"></span>
               <span class="fs-6 text-muted ms-3" x-text="recipe.auteur"></span>
           </div>
           <div class="float-end mt-1">
             <span class="badge bg-red" x-text="recipe.type"></span>
             <template x-for="categorie in recipe.categories">
               <span class="badge bg-green" x-text="categorie"></span>
             </template>
               <span>
                 <template x-for="saison in recipe.saison">
                  <span class="badge bg-pink" x-text="saison"></span>
                 </template>
               </span>
             <template x-if="recipe.specialite != '' ">
               <span class="badge bg-grey" x-text="recipe.specialite"> </span>
             </template>
           </div>
         </div>
        <div>
           <template x-if="recipe.temperature === 'Chaud'">
             <span class="badge bg-orange mx-0">Servir Chaud</span>
           </template>
           <template x-if="recipe.temperature === 'Froid'">
             <span class="badge bg-blue">Servir Froid</span>
           </template>
           <template x-if="recipe.cuisson === 'Oui'">
             <span class="badge bg-orange">Avec Cuisson</span>
           </template>
           <template x-if="recipe.cuisson === 'Non'">
             <span  class="badge bg-blue">Sans Cuisson</span>
           </template>
           <template x-for="regime in recipe.regimes">
             <span class="badge bg-grey me-1" x-text="regime"></span>
           </template>
         </div>
         <template x-if="recipe.materiel != ''" >
           <div>
             <template x-for="materiel in recipe.materiel">
               <span class="badge bg-grey me-1" x-text="materiel"></span>
             </template>
           </div>
         </template>
       </div>
     </a>
    </template>
    </div>
</div>
{{/*  
 */}}

<script>
{{/*  Auto focus on searchRecipesInput input (for modal searchRecipesInput module)  */}}
  var searchRecipesModal = document.getElementById('search-recipes-modal')
  var searchRecipesModalInput = document.getElementById('qsearch-recipes')

  searchRecipesModal.addEventListener('shown.bs.modal', function () {
    searchRecipesModalInput.focus()
  })
    searchRecipesModal.addEventListener('shown.bs.modal', function () {
    searchRecipesModalInput.focus()
  });


  document.addEventListener('alpine:init', () => {
    Alpine.data('searchRecipes', () => ({
    isOpen: false,
    searchRecipesInput: "",

    getRecipes() {
      if(this.searchRecipesInput.length > 2) {
        const filterRecipes = this.recipesData.filter((recipe) => {
        return this.searchRecipesInput.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, '').split(' ').every(
        v => recipe.title.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, '').includes(v) ||
        recipe.auteur.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, '').includes(v) ||
        recipe.specialite.toLowerCase().normalize('NFD').replace(/\p{Diacritic}/gu, '').includes(v))
        })
      
        if(filterRecipes.length > 0 ) {
          return filterRecipes
        }
      }
    },

      closeSearch() {
        this.searchRecipesInput = "";
        this.isOpen = false;
      },


    recipesData: [

      {{- range(where .Site.RegularPages "Section" "recettes" ) -}}

        {
          title: "{{ .Title }}",
          url: "{{ .RelPermalink }}",
          type: "{{ .Params.type }}",
          auteur: "{{- .Params.auteur -}}",
          specialite: "{{- .Params.spécialité -}}",
          saison: [{{- range .Params.saison -}} "{{ . }}", {{- end -}} ],
          categories: [ {{- range .Params.categories -}} "{{ . }}", {{- end -}}],
          regimes: [ {{- if .Params.regime -}} {{- range sort .Params.regime -}} "{{ . }}", {{- end -}} {{- end -}} ],
          temperature: "{{ .Params.temperature }}",
          cuisson: "{{ .Params.cuisson }}",
          materiel: [{{- range .Params.materiel -}}  "{{ . }}", {{- end -}}]
        },

      {{- end -}}
      ]

    }))
  })
</script>